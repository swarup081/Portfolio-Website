<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Funky CodeMirror Editor</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Press Start 2P', cursive;
      background: #111;
      color: #0f0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .toolbar {
      display: flex;
      justify-content: space-around;
      background: #222;
      padding: 10px;
      border-bottom: 3px dashed #0f0;
    }

    .toolbar button {
      font-family: 'Press Start 2P', cursive;
      background: #000;
      color: #0f0;
      border: 2px solid #0f0;
      padding: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    .toolbar button:hover {
      background: #0f0;
      color: #000;
    }

    .editor-container {
      display: flex;
      flex-grow: 1;
    }

    #editor, #preview {
      flex: 1;
      height: 100%;
      overflow: auto;
      padding: 10px;
      box-sizing: border-box;
    }

    #preview {
      background: #fff;
    }

    .CodeMirror {
      height: 100%;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="setMode('html')">HTML</button>
    <button onclick="setMode('css')">CSS</button>
    <button onclick="setMode('js')">JS</button>
    <button onclick="downloadFiles()">Download All</button>
  </div>

  <div class="editor-container">
    <textarea id="code"></textarea>
    <iframe id="preview"></iframe>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  <script>
    let currentMode = 'html';

    const starterCode = {
      html: `<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; }
  </style>
</head>
<body>
  <h1>Hello, world!</h1>
  <script src="script.js"></script>
</body>
</html>`,

      css: `body {
  background-color: lightblue;
  color: navy;
}`,

      js: `document.body.innerHTML += '<p>JS is working!</p>';`
    };

    const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
      lineNumbers: true,
      mode: 'xml',
      theme: 'default',
    });

    editor.setValue(starterCode.html);

    editor.on('change', () => updatePreview());

    function setMode(mode) {
      currentMode = mode;
      editor.setOption('mode', mode === 'html' ? 'xml' : mode);
      editor.setValue(starterCode[mode]);
      updatePreview();
    }

    function updatePreview() {
      if (currentMode === 'html') {
        document.getElementById('preview').srcdoc = editor.getValue();
      } else {
        let html = starterCode.html;
        let css = currentMode === 'css' ? editor.getValue() : starterCode.css;
        let js = currentMode === 'js' ? editor.getValue() : starterCode.js;

        const fullDoc = `<!DOCTYPE html>
<html>
<head>
  <style>${css}</style>
</head>
<body>
  <h1>Hello, world!</h1>
  <script>${js}<\/script>
</body>
</html>`;

        document.getElementById('preview').srcdoc = fullDoc;
      }
    }

    function downloadFiles() {
      const files = {
        'index.html': starterCode.html,
        'style.css': starterCode.css,
        'script.js': starterCode.js
      };

      Object.keys(files).forEach(filename => {
        const blob = new Blob([files[filename]], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();
      });
    }

    // Initial load
    updatePreview();
  </script>
</body>
</html>